@using Model;
@model VM_SemOutPrintIndexForInfoShow


@section head{
    <!---- style ---->
    <style type="text/css">
        #ShowSemOutPrintPreviewLayoutDIV{
            margin:0px;
            padding:0px;
            text-align:center;

            /*border:1px solid blue;*/
        }

        #ShowSemOutPrintPreviewLayoutDIV span{
            margin:0px;
            padding:0px;

            /*border:1px solid blue;*/
	    }

        #ShowSemOutPrintPreviewLayoutDIV .SetCenterDIV{
            margin:0 auto;
            padding:0px;
            text-align:left;
            width:858px;

            /*border:1px solid blue;*/
        }


        /* Button Layout */
        #ShowSemOutPrintPreviewLayoutDIV .FunctionButton_Area .CloseButton_Menument{
            margin: 0px 5px;
        }


        /* Title Layout */
        #ShowSemOutPrintPreviewLayoutDIV .PageTitle_div{
            margin:0px;
            padding:0px;

            /*border:1px solid blue;*/
        }

        #ShowSemOutPrintPreviewLayoutDIV .PageTitle_div #PrintInformationSpan{
            margin:0px 0px 0px 0.5%;
        }


        /* ShowSemOutPrintPreview Layout */
        #ShowSemOutPrintPreviewLayoutDIV .ShowSemOutPrintPreviewDIV{
            margin:2% 0px 0px 0px;
            padding:0px;
            text-align:left;

            /*border:1px solid blue;*/
        }


        /* Table Layout */
        #ShowSemOutPrintPreviewLayoutDIV .ContentManageDIV{
            margin:2% 0px 0px 0px;
            padding:0px;

            /*border:1px solid blue;*/
        }

        

    </style>


    <!-- javascript -->
    <script>
        (function ($) {
            /********* 自定义函数 *********/
            var SOPPGetDateFun = function () {
                var dateTime, formatDate;

                dateTime = new Date();
                formatDate = dateTime.getFullYear();
                formatDate = formatDate + "/" + (dateTime.getMonth() + 1);
                formatDate = formatDate + "/" + dateTime.getDate();

                return formatDate;
            }


            /********* 功能函数 *********/
            //关闭
            window.SOPPCloseFun = function () {

            } //end SOPPCloseFun

            //打印
            window.SOPPPrintFun = function () {

            } //end SOPPPrintFun


            /********* 表格函数 *********/
            //获取绑定字符串
            var SOPPGetBindStringFun = function () {
                var getBindString = Common.Functions.createDataGrid({//创建datagrid,详细内容参见functions.js
                    columns: SOPPGetColumnsFun(),
                    loadFilter: function (data) {
                        var semOutPrintPreviewLoadFilter = {};
                        semOutPrintPreviewLoadFilter.rows = data.rows ? data.rows : data;
                        semOutPrintPreviewLoadFilter.total = data.total ? data.total : 0;

                        return semOutPrintPreviewLoadFilter;
                    },
                    maxWidth: 858,
                    pagination: false,
                    singleSelect: true,
                    target: "#SemOutPrintPreviewTable",
                    url: "/Store/SemOutPrint/GetPreview?pickListID=@ViewBag.PickListID&tecnProductOutID=@ViewBag.TecnProductOutID&batchIDArr=@ViewBag.BatchIDArr&pickListDetailNOArr=@ViewBag.PickListDetailNOArr",
                    //事件
                    onClickRow: function () {
                        return false;
                    }, //end onClickRow
                    onCreating: function (data) {
                        if (data.rows.length > 0) { //如果远程加载有数据
                            for (var i = 0; i < $("#SemOutPrintPreviewTable").datagrid("getRows").length; i++) //遍历表中数据
                            {
                                if ($("#SemOutPrintPreviewTable").datagrid("getRows")[i]["PrintFlg"] == "1") //判断是否记录是否有被打印
                                {
                                    $("#PrintInformationSpan").text("(补印)");
                                    return;
                                }
                            } //end for
                        } //end if
                    }, //end onCreating
                    onDblClickRow: function () {
                        return false;
                    }, //end onDblClickRow
                    onLoadError: function () {
                        $.messager.alert("友情提示", "请求服务器失败，请刷新页面重试! ");
                    } //end onLoadError
                });
                return getBindString;
            } //end SOPPGetBindStringFun

            //获取列属性
            var SOPPGetColumnsFun = function () {
                var getColumns = [[
                    //列属性:field(字段,非空) ,title(列名,非空),width(默认80),sortable(默认false),editor(默认null),formatter(默认-函数)
                    //["field","title",width,rowspan,colspan,sortable,editor,formatter(v,r,index){}]
                    ["NO", "编号", 100, 2, null, true, null, function (value, rowData, rowIndex) {
                        return (rowIndex + 1);
                    }],
                    ["ProductName", "材料名称", 150, 2],
                    ["ProductSpec", "规格型号", 150, 2],
                    ["UnitName", "单位", 100, 2],
                    ["", "数量", 200, null, 2],
                    ["Remarks", "备注", 150, 2]
                ],
                [
                    ["AppoQuantity", "请领", 100],
                    ["ReceQuantity", "实发", 100]
                ]]
                return getColumns;
            } //end SOPPGetColumnsFun


            /********* 页面加载 *********/
            $(function () {
                SOPPGetBindStringFun();
                $("#DateSpan").text(SOPPGetDateFun());
                //$("#SemOutPrintPreviewTable").datagrid("loadData", InitSOPDFun());
                
            }) //end $(function () {})
   
        }(jQuery));
    </script>
}


<!-- layout -->
<div id="ShowSemOutPrintPreviewLayoutDIV">
    <!-- Button -->
    <div class="FunctionButton_Area">@UserHelpers.ButtonForPrint("PrintFun()")@UserHelpers.ButtonForClose("CloseFun()")</div>


    <!-- Line -->
    <div class="LevelLine_div"><hr /></div>


    <!-- Title -->
    <div class="PageTitle_div"><span>出库单打印选择</span><span id="PrintInformationSpan"></span></div>


    <!-- Information -->
    <div class="ShowSemOutPrintPreviewDIV">
        <div class="SetCenterDIV"><span style="margin:0px 0px 0px 72%;">单号：</span><span style="display:inline-block;width:20%;">@Model.TecnProductOutID</span></div>
        <div class="SetCenterDIV" style="margin-top:1%;"><span>调入单位：</span><span style="display:inline-block;width:30%;">@Model.CallinUnitName</span><span style="margin:0px 0px 0px 32.7%;">日期：</span><span id="DateSpan" style="display:inline-block;width:20%;"></span></div>
    </div>


    <!-- Table -->
    <div class="ContentManageDIV">
        <table id="SemOutPrintPreviewTable"></table>
    </div>

    <div class="SetCenterDIV" style="margin-top:2%;"><span>审批人：</span><span style="display:inline-block;width:12%;"></span><span style="margin:0px 0px 0px 20%;">领料人：</span><span style="display:inline-block;width:12%;">@Model.MaterHandlerName</span><span style="margin:0px 0px 0px 20%;">制单人：</span><span style="display:inline-block;width:12%;">@Model.WareHouseKpName</span></div>

</div>


@*<link rel="stylesheet" href="~/Content/css/Store/WipStore.css">
<script>

    var tableName = "#userTable";//待修改
    var formName = "#searchForm";//待修改
    var form4Add = "#form4Add";
    var form4Update = form4Add;

    var model = ["add", "update"];
    var addOrUpdate;//标志:添加还是修改

    var Id;//暂存修改时的id(主键)

    //搜索
    var searchFun = function () {
        $(formName).form("submit", {//ajax form提交
            url: "/Store/ProProduct/Get",       
            success: function (data) {
                $(tableName).datagrid("loadData", eval('(' + data + ')'));//重新加载数据
            }
        });
    }

    function SearchBox(value, name) {
        alert(value + ":" + name)
    }

    function printFun() {
        window.print();
        alert("打印功能");
    }

    function saveFun() {
        alert("保存功能");
    }


    function radioFun(value) {
        alert(value + "单选功能");
    }

    //列属性:field,title,width,sortable,editor,formatter
    var columns = [[
        ["DeliverId", "编号", 140, true],
        ["SupplierName", "产品名称", 120, true],     
        ["MatterName", "加工工艺", 90, true],
        ["MatterName", "单位", 90, true],
        ["Aduser", "数量", 90, true],
        ["Paydate", "备注", 180, true, true, function (value, row, index) {
            var date;
            var strDt = (value + "").replace(/\/Date\(/, "").replace(/\)\//, "");
            if (isNaN(strDt)) {
                date = strDt.ToDate();
            } else {
                date = new Date(strDt.ToInt());
            }
            var str = date.Format("yyyy-MM-dd");
            row.Paydate = str;
            if (row.SupplierName != undefined) {
                document.getElementById("SupplierName").innerHTML = row.SupplierName;
                document.getElementById("MatterName").innerHTML = row.MatterName;
                document.getElementById("DeliverId").innerHTML = row.DeliverId;
                document.getElementById("Id").innerHTML = row.Id;
                document.getElementById("Paydate").innerHTML = str;
            }
            return ;
        }]

    ]];

    $(function () {
        var preview_id = $("#preview_id").val();
        Common.Functions.createDataGrid({//创建datagrid,详细内容参见functions.js
            target: tableName,
            url: "/Store/SemOutPrint/SemOutPrintPreview?Pid=" + preview_id + "",
            columns: columns,
            showFooter: true,
            rownumbers: true,
            idField: "Id",
            toolbar: $("#toolbar"),//工具栏 
            maxWidth: 950,
            maxHeight: 500,
            pagination: false,
            onBeforeLoad: function (queryParams) {//可以添加一些额外参数,主要用于查询条件
                var arr = $(formName).serializeArray();
                $.each(arr, function () {
                    queryParams[this.name] = this.value;
                   
                });
            },
            onLoadError: function () {
                $.messager.alert("友情提示", "请求服务器失败，请刷新页面重试! "); 
            },
            onCreating: function (data) {
                //do something...
                //for (var i = 0 ; i < 1 ; i++) {
                //    $(tableName).datagrid("appendRow", {
                //        "Paydate": " ",
                //        "DeliverId":"合计",
                //        "Aduser": "合计数量"


                //    });
                //}
                //setTimeout(function () {
                //    $(tableName).datagrid("mergeCells", { index: 2, field: "DeliverId", colspan: 4 })
                //}, 100);
            }
            //}, loadFilter: function (data) {
            //    var _data = {};
            //    _data.rows = data.rows ? data.rows : data;
            //    _data.footer = [{ SupplierName: "sum" }];
            //    return _data;
            //}
        });
    });

</script>*@

@*<div class="buttons" style="width:100%;text-align:right;"><br />
    <a href='javascript:void(0);' class='easyui-linkbutton' iconCls='icon-print' onclick='printFun();'>打印</a>
    <a class="easyui-linkbutton" iconCls='icon-cancel' onclick='parent.closeTab(gTitle);'>关闭</a>
    <span style="width:100px;margin-right:10%">&nbsp;</span>
</div>
<div style="width:100%;margin:20px 0;">
    <hr style="width:100%;color:#95B8E7"/>
</div>
<div style="width:100%;text-align:center;">
    <h2>加工产品出库单  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(补印)<label id='DeliverId0' style="width:120px" aria-setsize=30></label></h2><br /> 
</div>
<div class="datagrid" style="text-align:center;width:100%;">
    <table id="userTable"></table>
</div>
        <div style="width:100%;text-align:left"><br />     
            &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
            &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
           审批人：<label id='SupplierName' style="width:120px"></label>*@
                 @*<input id='SupplierName'style="width:120px" type='text' class='easyui-validatebox' name='SupplierName'/>*@
            @*&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;  
            领料人：<label id='MatterName' style="width:120px"></label>
            &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; 
            制单人：<label id='Id' style="width:120px"></label>
          
</div>

<div id="toolbar" style='display:none'>
    <form id='searchForm' method='post'>
        <br/>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        单号：<label id='DeliverId' style="width:120px "; ></label>
        <br/><br />
        &nbsp;&nbsp;调入单位：<label id='' style="width:120px"></label>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;日期：<label id='Paydate' style="width:120px"></label>
       
    </form><br/>
        <input id="preview_id" type="hidden" value="@ViewBag.Outpreview_id" />
</div>*@


