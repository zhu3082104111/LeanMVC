@{
    ViewBag.Title = "总装调度单打印预览画面";
}
@using App_UI.Resource.ClientMessage
@using App_UI.Resource.ViewText.Common
@using App_UI.Resource.ViewText.Produce


@section head{
    <link rel="stylesheet" href="~/Content/css/Produce/NewBill.css" />
    <script>


        //关闭当前标签
        var closeFun = function() {
            parent.closeTab();
        };


        //改变日期格式
        function changeDate(value) {
            var date;
            var strDt = (value + "").replace(/\/Date\(/, "").replace(/\)\//, "");
            if (isNaN(strDt)) {
                date = strDt.ToDate();
            } else {
                date = new Date(strDt.ToInt());
            }
            var str = date.Format("yyyy-MM-dd");
            return str;
        }


        //根据总装调度号加载页面所有数据

        function loadData(id) {
            $.ajax({
                async: true,
                url: "/Produce/FAScheduleBill/LoadAllData",
                data: {
                    symbol: "@ViewBag.IsAdd",
                    id: id,
                    customerOrderId: "@ViewBag.customerOrderId",
                    customerOrderDetails: "@ViewBag.customerOrderDetails",
                    prodAbbrev: "@ViewBag.prodAbbrev",
                    assemblyPlanNum: "@ViewBag.assemblyPlanNum",
                    productId: "@ViewBag.productId"
                },
                dataType: "json",
                type: "post",
                success: function(data) {
                    if (data.isSuccess == true) {
                        setTimeout(function() {
                            $("#tabNewBillFirst").datagrid("loadData", data.oddGridData.Data);
                            $("#tabNewBillSecond").datagrid("loadData", data.evenGridData.Data);
                            if (data.oddGridData.Data.total > data.evenGridData.Data.total) {
                                $("#tabNewBillSecond").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                            }

                            $("#ProductType").html(data.HeadfootData.ProdAbbrev);
                            $("#CustomerOrderNum").html(data.HeadfootData.CustomerOrderNum);
                            $("#CustomerName").html(data.HeadfootData.CustomerName);
                            $('#SchedulingOrderDate').html(changeDate(data.HeadfootData.SchedulingOrderDate));

                            $("#Team").html(data.HeadfootData.Team);
                            $("#AssemblyPlanNum").html(data.HeadfootData.AssemblyPlanNum);
                            $("#AssPlaNum").html(data.HeadfootData.AssemblyPlanNum);
                            
                            $("#ActualAssemblyNum").html(data.HeadfootData.ActualAssemblyNum);
                            $("#PlanDeliveryDate").html(changeDate(data.HeadfootData.PlanDeliveryDate));

                            $("#TypingContent").html(data.HeadfootData.TypingContent);
                            $("#PackingFirst").html(data.HeadfootData.PackingFirst);
                            $("#PackingSecond").html(data.HeadfootData.PackingSecond);
                            $("#WareHouseBoxCer").html(data.HeadfootData.WareHouseBoxCer);
                            $("#WareHouseOdd").html(data.HeadfootData.WareHouseOdd);
                            $("#PackingThird").html(data.HeadfootData.PackingThird);
                            $("#TotalNumberOfSets").html(data.HeadfootData.TotalNumberOfSets);
                            $("#Remarks").html(data.HeadfootData.Remarks);

                            if (data.HeadfootData.WareHouseDate == null) {
                                $("#WareHouseDate").html("");
                            } else {
                                $("#WareHouseDate").html(changeDate(data.HeadfootData.WareHouseDate));
                            }
                            
                            $("#Dispatcher").html(data.HeadfootData.DispatcherName);
                            $("#WareHouseKeeperID").html(data.HeadfootData.WareHouseKeeperIDName);
                            $("#Inspector").html(data.HeadfootData.InspectorName);
                            $("#WareHousePerson").html(data.HeadfootData.WareHousePersonName);
                            
                        }, 10);
                    } else {
                        $.messager.alert("@VT_Common.Info", "@CM_Common.MSG0002");
                    }
                },
                error: function() {
                    $.messager.alert("@VT_Common.Info", "@CM_Common.MSG0002");
                }
            });
        }

        //列属性:field(字段,非空) ,title(列名,非空),width(默认80),sortable(默认false),editor(默认null),formatter(默认-函数)
        var columns = [[
            ["SubItemID", "@VT_FAScheduleBill.SubItemID", 92, false, null],
            ["PartName", "@VT_FAScheduleBill.PartName", 253, false, null, function(value, row, index) {
                return "<div style='text-align: left; font-size: 12px'>" + value + "</div>";
            }],
            ["BatchNumber", "@VT_FAScheduleBill.BatchNumber", 100, false, null],
            ["ConstQty", "@VT_FAScheduleBill.ConstQty", 50, false, null],
            ["Remark", "@VT_FAScheduleBill.Remarks", 63, false, "text"]]];

        $(function() {
            Common.Functions.createDataGrid({
                //创建datagrid,详细内容参见functions.js
                target: $("#tabNewBillFirst"),//table容器,必须
                //url:"", //"/Admin/UserInfo/Get",//获取数据的地址,必须
                columns: columns,//列属性,必须
                //idField: "OrderNo",//标识字段
                //toolbar: $("#toolbar"),//工具栏
                checkbox: false,//是否显示checkbox
                maxWidth: 565,//最大宽度
                maxHeight: 0,//最大高度
                pagination: false,
                singleSelect: true,
                showFooter: false,
                onClickRow: function() {
                    //endEditing("#tabNewBillFirst");
                    return false;
                },
                onDblClickRow: function(rowIndex, rowData) {
                    //onClickRow(rowIndex, "#tabNewBillFirst");
                    return true;
                },
                onBeforeLoad: function(queryParams) { //可以添加一些额外参数,主要用于查询条件
                },
                onLoadError: function() {
                    $.messager.alert("@VT_Common.Info", "@CM_Common.MSG0002");
                },
                onCreating: function(data) { //数据成功加载
                    //do something...
                    //return false;
                },
                loadFilter: function(data) {
                    var d = {};
                    d.rows = data.rows ? data.rows : data;
                    //d.footer = [{ CodeName: "合计", NameType: "", BatchNumber: "icon-sum", Number: "", Remark: "", footer: true }]; //统计信息
                    return d;
                }
            });
            Common.Functions.createDataGrid({
                //创建datagrid,详细内容参见functions.js
                target: $("#tabNewBillSecond"),//table容器,必须
                //url:"", //"/Admin/UserInfo/Get",//获取数据的地址,必须
                columns: columns,//列属性,必须
                //idField: "OrderNo",//标识字段
                //toolbar: $("#toolbar"),//工具栏
                checkbox: false,//是否显示checkbox
                maxWidth: 565,//最大宽度
                maxHeight: 0,//最大高度
                pagination: false,
                singleSelect: true,
                showFooter: false,
                onClickRow: function() {
                    //endEditing("#tabNewBillSecond");
                    return false;
                },
                onDblClickRow: function(rowIndex, rowData) {
                    //onClickRow(rowIndex, "#tabNewBillSecond");
                    return true;
                },
                onBeforeLoad: function(queryParams) { //可以添加一些额外参数,主要用于查询条件
                },
                onLoadError: function() {
                    $.messager.alert("@VT_Common.Info", "@CM_Common.MSG0002");
                },
                onCreating: function(data) { //数据成功加载
                    //do something...
                    //return false;
                },
                loadFilter: function(data) {
                    var d = {};
                    d.rows = data.rows ? data.rows : data;
                    //d.footer = [{ CodeName: "合计", NameType: "", BatchNumber: "icon-sum", Number: "", Remark: "", footer: true }]; //统计信息
                    return d;
                }
            });
            setTimeout(function() {
                $("#tabNewBillFirst").datagrid("loadData", [{ SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" }]);
                $("#tabNewBillFirst").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                $("#tabNewBillFirst").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                $("#tabNewBillFirst").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                $("#tabNewBillFirst").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                $("#tabNewBillSecond").datagrid("loadData", [{ SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" }]);
                $("#tabNewBillSecond").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                $("#tabNewBillSecond").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                $("#tabNewBillSecond").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
                $("#tabNewBillSecond").datagrid("appendRow", { SubItemID: "", PartName: "", BatchNumber: "", ConstQty: "", Remark: "" });
            }, 10);

            var id = "@ViewBag.assemblyTicketId";
            loadData(id);

            //按钮事件绑定
            $("#btnClose").bind('click', closeFun);
            $("#btnPrint").bind('click', function () { self.print(); });
        });

    </script>
}

<div class="buttons noprint" style="width: 100%; text-align: right;">
    @UserHelpers.ButtonForPrint("", "btnPrint")
    @UserHelpers.ButtonForClose("", "btnClose")
    <span style="width: 100px; margin-right: 10%">&nbsp;</span>
</div>

@UserHelpers.Line()

<table style="text-align: center; width: 100%;">
    <tr>
        <td style="width: 200px" rowspan="2"></td>
        <td>
            @UserHelpers.Company_Title(VT_Common.CompanyName)
        </td>
        <td rowspan="2" style="width: 200px">
            <div style="width: 150px; height: 100px; background-color: #8fbc8f; margin-right: 100px; text-align: center;">
                <img />
                <div style="padding-top: 40px;">条形码</div>
            </div>
        </td>
    </tr>
    <tr>
        <td>
            @UserHelpers.Title(VT_FAScheduleBill.IndexTitle)
        </td>
    </tr>
</table>
<br/>
<form id="viewForm" method="post" class="Search_Form">
    <div class="datagrid" style="text-align: center; width: 100%;">
        <div style="text-align: center; width: 1130px; margin: auto">
            <table id="tabHeader" style="width: 1130px; height: auto;">
                <tr>
                    <td style="width: 90px">@VT_FAScheduleBill.ProdAbbrev:</td>
                    <td style="width: 251px"><label id="ProductType" name="ProductType" ></label></td>
                    <td style="width: 98px">@VT_FAScheduleBill.CustomerOrderNum:</td>
                    <td style="width: 113px"><label id="CustomerOrderNum" name="CustomerOrderNum"></label></td>
                    <td style="width: 90px">@VT_FAScheduleBill.CustomerName:</td>
                    <td style="width: 250px"><label id="CustomerName" name="CustomerName"></label></td>
                    <td style="width: 98px">@VT_FAScheduleBill.SchedulingOrderDate：</td>
                    <td><label id="SchedulingOrderDate" name="SchedulingOrderDate"></label></td>
                </tr>
                <tr>
                    <td>@VT_FAScheduleBill.Team:</td>
                    <td><label id="Team" name="Team"></label></td>
                    <td>@VT_FAScheduleBill.AssemblyPlanNumD:</td>
                    <td><label id="AssemblyPlanNum" name="AssemblyPlanNum"></label>
                        <span id="AssPlaNum" name="AssPlaNum" style="display: none"></span>
                    </td>
                    <td>@VT_FAScheduleBill.ActualAssemblyNum:</td>
                    <td><label id="ActualAssemblyNum" name="ActualAssemblyNum"></label></td>
                    <td>@VT_FAScheduleBill.PlanDeliveryDate：</td>
                    <td><label id="PlanDeliveryDate" name="PlanDeliveryDate"></label></td>
                </tr>
            </table>
        </div>
        <div id="tabContent" style="text-align: center; width: 1130px; margin: auto">
            <div id="divFirst" style="float: left;">
                <table id="tabNewBillFirst" style=" height: auto;"></table>
            </div>
            <div id="divSecond" style="float: left; ">
                <table id="tabNewBillSecond" style=" height: auto;"></table>
            </div>
        </div>
        <div style="text-align: center; width: 1130px; margin: auto; clear: both;">
            <table id="tabInput" style="width: 1130px; height: auto;">
                <tr style="height:0;border-width: 0 0 0 0;border-style:none;" >
                    <td style="width: 88px" ></td>
                    <td style="width: 243px"></td>
                    <td style="width: 546px"></td>
                    <td style="width: 83px"></td>
                    <td style="width: 120px"></td>
                </tr>
                <tr class="view">
                    <td >@VT_FAScheduleBill.TypingContent：</td>
                    <td colspan="4">
                        <label id="TypingContent" name="TypingContent" style="width:300px ;text-align: left;display: block;" ></label>
                    </td>
                </tr>
                <tr class="view">
                    <td >@VT_FAScheduleBill.PackingFirst：</td>
                    <td colspan="2" >
                        <label id="PackingFirst" name="PackingFirst" style="width:300px ;text-align: left;display: block;" ></label>
                    </td>
                    <td colspan="2" >@VT_FAScheduleBill.WareHouseBox</td>
                </tr>
                <tr class="view">
                    <td>@VT_FAScheduleBill.PackingSecond：</td>
                    <td colspan="2">
                        <label id="PackingSecond" name="PackingSecond" style="width:300px ;text-align: left;display: block;" ></label>
                    </td>
                    <td colspan="2">@VT_FAScheduleBill.WareHouseBoxCer1
                        <label id="WareHouseBoxCer" name="WareHouseBoxCer"></label>@VT_FAScheduleBill.WareHouseBoxCer2+<span id="WareHouseOdd" name="WareHouseOdd">&nbsp;</span>@VT_FAScheduleBill.WareHouseOdd
                    </td>
                </tr>
                <tr class="view">
                    <td colspan="2">@VT_FAScheduleBill.PackingThird：</td>
                    <td colspan="1">
                        <label id="PackingThird" name="PackingThird" style="width:300px ;text-align: left;display: block;" ></label>
                    </td>
                    <td colspan="2">@VT_FAScheduleBill.TotalNumberOfSets1：<span id="TotalNumberOfSets">&nbsp;</span>@VT_FAScheduleBill.TotalNumberOfSets2</td>
                </tr>
                <tr class="view">
                    <td>@VT_FAScheduleBill.Remarks：</td>
                    <td colspan="2">
                        <label id="Remarks" name="Remarks" style="width:300px ;text-align: left;display: block;" ></label>
                    </td>
                    <td >@VT_FAScheduleBill.WareHouseDate</td>
                    <td><label id="WareHouseDate" name="WareHouseDate"></label></td>
                </tr>
            </table>
        </div>
        <table id="tabFoot">
            <tr>
                <td>@VT_FAScheduleBill.Dispatcher：<label id="Dispatcher" name="Dispatcher"></label></td>
                <td>@VT_FAScheduleBill.WareHouseKeeperID：<label id="WareHouseKeeperID" name="WareHouseKeeperID"></label></td>
                <td>@VT_FAScheduleBill.Inspector：<label id="Inspector" name="Inspector"></label></td>
                <td>@VT_FAScheduleBill.WareHousePerson:<label id="WareHousePerson" name="WareHousePerson"></label></td>
            </tr>
        </table>
    </div>
</form>

