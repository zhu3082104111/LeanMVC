
@using App_UI.Resource.ViewText.Common
@using App_UI.Resource.ViewText.Produce
@using Model

@section head
{
    <style>
        input.easyui-datebox {
            width: 110px;
        }
        table.headTable td, table.footTable td {
            width: 100px;overflow: hidden;display: inline-block;
        }
        input.dataClass {
            width: 100%;height: 92%
        }

        .datagrid .datagrid-body tr {
            height: 30px;
        }
        input {
            width: 110px;
        }
    </style>
    
    <script>
        (function($) {
            /*******************变量-开始******************/
            var table = "#WarehouseDetailTable"; //表格
            var form = "#warehouseDetailForm"; //表单
            var productWarehouseId = "@ViewBag.productWarehouseID"; //通过详细转过来时有值
            var warehouseState = null;//交仓单状态

            /*******************变量-结束******************/

            window.print_warehouseDetail = function () {
                console.info(warehouseState);
                if (warehouseState == "@Constant.ProductWarehouseState.UNSUBMIT") {
                    $("#nullForm").formSubmit([
                        "/Produce/ProductWarehouse/UpdateWarehouseState",
                        function(param) {
                            param["productWarehouseId"] = "@ViewBag.productWarehouseID";
                        },
                        function (data) {
                            var result = eval("(" + data + ")");
                            result = result.result;
                            if (result.result) {
                                warehouseState = "@Constant.ProductWarehouseState.SUBMITED";
                            }
                            setTimeout(function() {
                                self.print();
                            }, 50); 
                        }
                    ]);
                } else {
                    self.print();
                }
            };

            //关闭
            window.close_warehouseDetail = function() {
                parent.closeTab();
            };


            /*******************按钮-结束******************/


            /*******************方法-开始******************/


            //返回列属性
            var getColumns = function() {
                var columns = [[], []];
                //["field", "title", "width", "rowspan", "colspan", "sortable", "editor", "formatter"]
                columns[0].push(["ClientOrderID", "@VT_InProcessing.OrderId", 120, 2, 1, false, null]);
                columns[0].push(["TeamName", "@VT_ProductWarehouse.AssembleTeam", null, 2, 1, false]);
                columns[0].push(["OrderProductID", "@VT_ProductWarehouse.OrderProductId", 90, 2, 1, false, null]);
                columns[0].push(["ProductName", "@VT_ProductWarehouse.ProductName", 100, 2, 1, false]);
                columns[0].push(["ProductSpecification", "@VT_ProductWarehouse.ProductSpecification", 100, 2, 1, false, null]);
                columns[0].push(["Unit", "@VT_ProductWarehouse.Unit", 50, 2, 1, false]);
                columns[0].push(["QualifiedQuantity", "@VT_ProductWarehouse.QualifiedQuantity", 70, 2, 1, false, null]);
                columns[0].push(["", "@VT_ProductWarehouse.PackState", null, 1, 3]);
                columns[0].push(["Remark", "@VT_ProductWarehouse.Remark", 120, 2, 1, false, null]);

                columns[1].push(["EachBoxQuantity", "@VT_ProductWarehouse.EachBoxQuantity", 70, 1, 1, false, null]);
                columns[1].push(["BoxQuantity", "@VT_ProductWarehouse.BoxQuantity", 60, 1, 1, false, null]);
                columns[1].push(["RemianQuantity", "@VT_ProductWarehouse.RemianQuantity", 60, 1, 1, false, null]);
                return columns;
            };

            /*******************方法-结束******************/


            /*******************Ready******************/
            $(function() {
                table = $(table);
                form = $(form);
                Common.Variables.datagrid.nullDataMessage = "@VT_ProductWarehouse.NullWarehouseData"; //表格无数据时显示的信息
                Common.Functions.createDataGrid({
                    target: table,
                    url: "/Produce/ProductWarehouse/GetDetail",
                    columns: getColumns(),
                    pagination: false,
                    sortName: "",
                    sortOrder: "",//默认排序
                    maxWidth: 1030,//最大宽度
                    maxHeight: 600,//最大高 度
                    loadFilter: function(data) {
                        var _data = {};
                        _data.rows = data.rows.Children;
                        warehouseState = data.rows["WarehouseState"];
                        AdaptDt(table, [data.rows], "WarehouseDT");
                        setTimeout(function() {
                            FillByName(data.rows, "#warehouseDetailForm");
                        }, 50);
                        return _data;
                    },
                    onBeforeLoad: function(param) {
                        param["productWarehouseID"] = "@ViewBag.productWarehouseID";
                    },
                    onDblClickRow: function() {
                        return false;
                    },
                    onClickRow: function() {
                        return false;
                    },
                    onCreating: function() {
                    }
                });
            });
        }(jQuery));

    </script>
    }





    @*buttons*@
    <div class="buttons noprint" style="width: 100%; text-align: right; margin-top: 10px;">
        @UserHelpers.ButtonForPrint("print_warehouseDetail()")
        @UserHelpers.ButtonForClose("close_warehouseDetail()", "closeBtn")
    </div>

    @*title*@
    <div style="width: 100%; text-align: center; margin-bottom: 10px;">
        @UserHelpers.Line()
        @UserHelpers.Company_Title(VT_Common.CompanyName)
        @UserHelpers.Title(VT_ProductWarehouse.ProductWarehouseTitle)
    </div>
    @*form*@
    <div style="width: 100%; text-align: center; margin-bottom: 10px;">
    <div style="width: 1000px; margin: auto; text-align: left;">
        <form method="post" id="warehouseDetailForm" class="Search_Form" style="text-align: center;"> 
            <div>
                <table class="headTable" style="width: 900px; margin: auto; margin-bottom: 10px;">
                    <tr>
                        <td colspan="8" style="width:70.7%;"></td>
                        <td style="text-align: right;">@VT_ProductWarehouse.Id：</td>
                        <td><span name="ProductWarehouseID"></span></td>
                    </tr>
                    <tr>
                        <td>@VT_ProductWarehouse.DepartmentName：</td>
                        <td style="text-align: left;">
                            <span name="DepartmentID"></span>
                        </td>
                        <td></td>
                        <td>@VT_ProductWarehouse.BatherID：</td>
                        <td style="text-align: left;"><span name="BatchID"></span> </td>
                        <td colspan="3"></td>
                        <td style="text-align: right">@VT_ProductWarehouse.WarehouseDT：</td>
                        <td>
                            <span name="WarehouseDT"></span>
                        </td>
                    </tr>
                </table>                
            </div>

            <div class="datagrid">
                <table id="WarehouseDetailTable"></table>
            </div>

            <div style="text-align: left; margin-top: 10px;">
                <table class="footTable" style="width: 900px; margin: auto; margin-bottom: 10px;">
                    <tr>
                        <td style="width:70px;margin-left:35px">@VT_ProductWarehouse.WarehousePersonName：</td>
                        <td><span name="WarehousePersonName"></span></td>
                        <td></td>
                        <td>@VT_ProductWarehouse.CheckPersonName：</td>
                        <td><span name="CheckPersonName"></span></td>
                        <td colspan="1"></td>
                        <td>@VT_ProductWarehouse.DispatherPersonName：</td>
                        <td><span name="DispatherName"></span></td>
                    </tr>
                </table>
            </div>
        </form>
    </div>
</div>


    <form method="POST" id="nullForm"></form>
    

