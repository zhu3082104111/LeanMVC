@using Model.Produce
@using App_UI.Resource.ViewText.Produce
@using Model
@model IDictionary<string, Object>
@{
    ViewBag.Title = "总装大工票";
    Layout = "~/Views/Shared/_DefaultLayout.cshtml";
}

<style type="text/css">
    .details {
        text-align:center;
        margin:auto;
        padding-left:80px;
        padding-right:80px;
    }

    .a {
        font-size: 24px;
        color: red;
    }

    .table_detail {
        width: 100%;
        height:100%;
        border-collapse: collapse;
        border-width: 0px;
    }

    .table_detail td {
        border-style:solid;
        border-color: #838383;
        border-width: 1px;
        text-align: center;
        font-size: 15px;
        height:100%;
        width:78px;
    }

    .table_detail .tr_thead {
        text-align: center;
    }


    .table_detail tr {
      
        color: #2B5E80;
        font-weight: 700;
    }
    .table_detail input {
        width:70px;
        height:20px;
        line-height:20px;
    }


    .table_detail .height30 {
        height: 30px;
    }

    .tr_thead td {
        filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0);
        -ms-filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0); /*IE8*/
        background: -moz-linear-gradient(top, red, rgba(0, 0, 255, 0.5));
        background: -webkit-gradient(linear, 0 0, 0 bottom, from(#f6f6f6), to(rgba(216, 216, 218, 1)));
    }
    .table_detail .css3div{
        font-size:inherit;
         filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0);
        -ms-filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0); /*IE8*/
        background: -moz-linear-gradient(top, red, rgba(0, 0, 255, 0.5));
        background: -webkit-gradient(linear, 0 0, 0 bottom, from(#f6f6f6), to(rgba(216, 216, 218, 1)));
    }
    .table_detail .css3td {
        filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0);
        -ms-filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0); /*IE8*/
        background: -moz-linear-gradient(top, red, rgba(0, 0, 255, 0.5));
        background: -webkit-gradient(linear, 0 0, 0 bottom, from(#f6f6f6), to(rgba(216, 216, 218, 1)));
    }

    .table_detail .tr_data {
        background-color: white;
    }

    .table_detail .tr_data td {
    }

    td .td_detail_input {
        width: 32px;
        height: 32px;
    }

    .form_detail {
        width: 100%;
        height: 100%;
    }

    .detail-div_head {
        width: 100%;
        margin-bottom: 20px;
        position: relative;
        float: left;
        display: inline;
    }

    #box {
        border: 1px solid #696;
        padding: 60px 0;
        text-align: center;
        width: 100%;
        box-shadow: #666 0px 2px 3px; /*CSS3*/
        background: #EEFF99;
        background: -webkit-gradient(linear, 0 0, 0 bottom, from(#EEFF99), to(#66EE33)); /*Safari、Chomre*/
        background: -moz-linear-gradient(#EEFF99, #66EE33); /*Firefox*/
        background: linear-gradient(#FFFFFF, rgba(199, 199, 199, 0.59));
    }

    .width_33 {
        width: 33%;
    }
    .height_22 {
        height:22px;
        line-height:22px;
    }
    .height_28 {
        height:28px;
        line-height:28px;
    }
     .height_47 {
        height:47px;
        line-height:47px;
    }

    .display_inline {
        display: inline;
    }

    .span_title {
        font-size: 18px;
        width: 33%;
    }

    .span_orderId {
        width: 33%;
    }

    .font_red {
        color: red;
    }

    .font_size16 {
        font-size: 16px;
    }

    .align_center {
        text-align: center;
    }

    .align_left {
        text-align: left;
    }

    .margin_bottom20 {
        margin-bottom: 20px;
    }

    .margin_top20 {
        margin-top: 20px;
    }

    .display_block {
        display: block;
    }

    .input_width {
        width: 45px;
    }

    .width85 {
        width: 76px;
    }

    .gradient {
        width: 300px;
        height: 150px;
        filter: alpha(opacity=100 finishopacity=50 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#FFFFFF',endcolorstr='#c4c0c0',gradientType=0);
        -ms-filter: alpha(opacity=100 finishopacity=50 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#FFFFFF',endcolorstr='#c4c0c0',gradientType=0); /*IE8*/
        background: red; /* 一些不支持背景渐变的浏览器 */
        background: -moz-linear-gradient(top, red, rgba(0, 0, 255, 0.5));
        background: -webkit-gradient(linear, 0 0, 0 bottom, from(#FFFFFF), to(rgba(209, 209, 209, 0.8)));
    }
    .margin_left_34 {
        margin-left: 34%;
    }
    .table_Order {
        width:70%;
        font-size:15px;
        background-color:white;
        
        border-collapse: collapse;
    }
    .table_Order td {
         
        border-width:1px;
        border-style:solid;
         border-color:#909296;
    }
        .table_Order input {
            width:70px;
        }
        .table_Order .css3div{
        font-size:inherit;
         filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0);
        -ms-filter: alpha(opacity=100 finishopacity=100 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr='#f6f6f6',endcolorstr='#d8d8da',gradientType=0); /*IE8*/
        background: -moz-linear-gradient(top, red, rgba(0, 0, 255, 0.5));
        background: -webkit-gradient(linear, 0 0, 0 bottom, from(#f6f6f6), to(rgba(216, 216, 218, 1)));
    }
    .table_CtmOrder {
        margin-top:15px;
        font-size:13px;
    }
     .table_CtmOrder input {
            width:40px;
        }

    .table_AssemInfo {
        width:100%;
        font-size:13px;
    }
    .table_Bottom {
        width:100%;
    }
</style>
<script type="text/javascript">
    //确定按钮,添加和修改数据,待修改
    var operator_Btn_Ensure_Fun = function () {
        alert("dy");
        $("#Detail_Form").formSubmit([
                "/Produce/FAWorkticketAll/Update",
                function (param) {
                    return true;
                    //console.info($(data_Table_Name).find("input:checkbox").is(":checked"));
                },
                function (data) {
                    var _data = eval('(' + data + ')');
                    if (_data.result == false) {//返回的结果(true/false)
                        alert(_data.Message);
                        return;
                    } else {//成功
                        alert("保存成功！");
                    }
                }
        ]);

    };

    var makePickingBillFun = function () {
        $.ajax({
            async: true,
            url: "/Produce/PickingBill/IsCanCreateByBigWorkticket/@ViewBag.bill.AssemBillID",
                type: "GET",
                success: function (data) {
                    if (data == true) {
                        parent.addTab("@VT_PickingBill.DetailsTabName", '/Produce/PickingBill/CreateByBigWorkticket/@ViewBag.bill.AssemBillID');
                    } else {
                        alert("该总装工票已经领完物料，不能再开具领料单！");
                    }
                },
             error: function () {
                 $.messager.progress("close");
                 console.info(arguments);
                 alert("请求服务器失败，请刷新页面重试!");
             }
         });
     }

    function createRow(table,offsetRow) {
        var rows = table.find("tr");
        var length = rows.length;
        //计划日期
        var row = rows.get(length - offsetRow - 3);
        row = $(row);
        var tds = row.find("td");

        var no = row.find("input[name='no']");

        var date = row.find("input[name='date']");


        var tr = "<tr class='datagrid-header-row'><td class='width85'><div class='css3div height_28'>计划日期：</div></td>";
        for (var i = 0; i < tds.length - 1; i++) {
            if (i < no.length) {
                var s = $(no[0]).val();
                s = parseInt(s) + 1;
                tr = tr + "<td class='width85'><input type='hidden' name='no' value='" + s + "'/><input type='text' name='date' value='' /></td>";

            } else {
                tr = tr + "<td class='width85'></td>";
            }
        }
        tr = tr + "</tr>";
        table.append(tr);
        tr = "";
        //操作者
        row = rows.get(length - offsetRow - 2);
        row = $(row);
        var op_pro_no = row.find("input[name = 'op_pro_no']");

        tr = "<tr class='datagrid-header-row'><td class='width85'><div class='css3div height_28'>操作者：</div></td>";
        for (var i = 0; i < tds.length - 1; i++) {
            if (i < no.length) {
                var s = $(op_pro_no[0]).val();
                tr = tr + "<td class='width85'><input type='hidden' name='op_pro_no' value='" + s + "' /><input type='text' name='opetator' value='' /><input name='newData' type='hidden' value='1'/></td>";

            } else {
                tr = tr + "<td class='width85'></td>";
            }
        }
        tr = tr + "</tr>";
        table.append(tr);
        tr = "";
        //计划数量
        row = rows.get(length - offsetRow - 1);
        row = $(row);
        tr = "<tr class='datagrid-header-row'><td class='width85'><div class='css3div height_28'>数量：</div></td>";
        for (var i = 0; i < tds.length - 1; i++) {
            if (i < no.length) {
                tr = tr + "<td class='width85'><input type='text' name='count' value='' /></td>";
            } else {
                tr = tr + "<td class='width85'></td>";
            }
        }
        tr = tr + "</tr>";
        table.append(tr);

    }

    function addRow() {
        var table1 = $("#table_detail_1");
        var table2 = $("#table_detail_2");
        createRow(table1,0);
        createRow(table2,0);
    }
    function changeBeginPickCount() {
        var beginPickCount = $(".planPickCount").html();
        beginPickCount = 0;
        var count = $("input[name='AssemblyPlanNum']");
        beginPickCount = parseInt(beginPickCount);
        for (var i = 0; i < count.length; i++) {
            var val = $(count.get(i)).val();
            if (val == "") {
                val = 0;
            }
            beginPickCount += parseInt(val);
        }
        $(".planPickCount").html(beginPickCount);
    }


    function countPlanCount() {
        
        var beginPickCount = $("#LoadCount").val();
        beginPickCount = 0;
        var count = $("input[name='ActualAssemblyNum']");
        beginPickCount = parseInt(beginPickCount);
        for (var i = 0; i < count.length; i++) {
            var val = $(count.get(i)).val();
            if (val == "") {
                val = 0;
            }
            beginPickCount += parseInt(val);
        }
        $("#LoadCount").val(beginPickCount);
    }
    function pageClose() {
        parent.closeTab();

    }
    var isDisable = false;

    function changeInputState() {
        isDisable = !isDisable;
        var inputs = $("#Detail_Form").find(".old");
        for (var i = 0; i < inputs.length; i++) {
            var inp = inputs[i];
           inp.disabled = isDisable;
           //inp.attr("disabled",true);
        }
        $("#controlDisable").attr("disabled",false);
    }
    $(function () {
        changeInputState();
        changeBeginPickCount();
        countPlanCount();
    });
</script>
 <div class="FunctionButton_Area">
     @UserHelpers.Button("makePickingBillFun()","开具领料单")
                @UserHelpers.ButtonForSave("operator_Btn_Ensure_Fun()")
                @UserHelpers.ButtonForClose("pageClose()")
                @UserHelpers.Line()
</div>  
<div class="details">
    <form id="Detail_Form" method="post" class="form_detail">
         
        <div class="detail-div_head display_inline">
            <div>
                 @UserHelpers.Title("总装大工票"," ")
            </div>
            <div style="font-size:14px;float:right;">
                <div style="width:220px;height:70px;margin-top:-20px;border-style:solid;border-color:red;border-width:1px;"></div>
                <div class="display_inline">
                    <span class="span_orderId font_red">工票号码：@ViewBag.bill.AssemBillID<input type="hidden" class="" name="AssemBillID" value="@ViewBag.bill.AssemBillID" /></span>
                </div>
            </div>
           
            <div>
                <table class="table_CtmOrder">
                @{
                   Object obj;
                   bool flag = ViewData.TryGetValue("adList", out obj);
                   if (flag){

                       IList<VM_AssemblyDispatch> adList = (IList<VM_AssemblyDispatch>)obj;
                       int k=adList.Count;
                       for(int n=0;n<k;n++){
                           VM_AssemblyDispatch temp = adList.ElementAt(n);
                            <tr>
                                <td>客户订单号：</td><td>@temp.CustomerOrderNum<input type="hidden" name="AssemblyDispatchID" value="@temp.AssemblyDispatchID"/></td>
                                <td>数量：</td><td><input type="text" value="@temp.AssemblyPlanNum.ToString("0")" name="AssemblyPlanNum" onkeyup="changeBeginPickCount();"/></td>
                                <td>装配数量：</td><td><input type="text" value="@temp.ActualAssemblyNum.ToString("0")" name="ActualAssemblyNum" onkeyup="countPlanCount();"/></td>
                                @{n+=1;}
                                @{if (n >= k) { break; } temp = adList.ElementAt(n);}
                                <td>客户订单号：</td><td>@temp.CustomerOrderNum<input type="hidden" name="AssemblyDispatchID" value="@temp.AssemblyDispatchID"/></td>
                                <td>数量：</td><td><input type="text" value="@temp.AssemblyPlanNum.ToString("0")" name="AssemblyPlanNum"/></td>
                                <td>装配数量：</td><td><input type="text" value="@temp.ActualAssemblyNum.ToString("0")" name="ActualAssemblyNum"/></td>
                            </tr>
                       }
                   }
                }
                </table>
                
            </div>  

        </div>
        <div class="align_left Search_Form">
            <table class="table_AssemInfo">
                <tr>
                    <td ">
                        型号：
                    </td>
                    <td>
                        @ViewBag.bill.ProductType
                    </td>
                    <td>
                        计划数量：
                    </td>
                    <td><span class="planPickCount">@ViewBag.bill.PlanCount.ToString("0")</span></td>
                    <td>
                        装配数量：
                    </td><!--ViewBag.bill.LoadCount.ToString()-->
                    <td><input name="LoadCount" id="LoadCount" value="@ViewBag.bill.LoadCount.ToString("0")" /></td>
                    <td>
                        <input type="checkbox" name="" id="controlDisable" onchange="changeInputState()"/>编辑以前资料
                    </td>
                    <td>
                         <input name="isOver" value="0" type="radio" @{string html = "checked"; if("1".Equals(ViewBag.bill.IsOver)){ @html;}}/>已完结
                         <input name="isOver" value="0" type="radio" @{if(!"1".Equals(ViewBag.bill.IsOver)){ @html;}}/>未完结
                    </td>
                    <td><input type="button" value="添加" onclick="addRow();"/></td>
                </tr>
            </table>
            

        </div>
        
            @{
                //Object obj;
                flag = Model.TryGetValue("process", out obj);
                if (flag)
                {
                    //有数据
                    IDictionary<int, string> dy_process = (Dictionary<int, string>)obj;
                    int process_count = dy_process.Count();
                    int max_col = 11;
                    int mark_count = 0;
                    int new_count = 0;
                    int temp_count = 0;
                    flag = Model.TryGetValue("number", out obj);
                    if (flag)
                    {
                        <table class="datagrid-htable table_detail " id="table_detail_1">
                       @{ 
                        IDictionary<int, string> dy_number = (IDictionary<int, string>)obj;

                        flag = Model.TryGetValue("no", out obj);//顺序

                        IEnumerable<int> no = (IEnumerable<int>)obj;
                        <tr class="datagrid-header-row ">
                        <td class="width85"><div class="css3div height_28">工序：</div></td>
                        @foreach (var n in no)
                        {
                            mark_count++;
                            string temp_str;
                            dy_process.TryGetValue(n, out temp_str);//工序号
                            <td class="width85"><div class="css3div height_28">@temp_str<input name="process_no" type="hidden" value="@n"/></div></td>
                            if (mark_count >= max_col)
                            {

                                break;
                            }
                        }  
                        @for (int i = mark_count; i < max_col; i++)
                        {
                            <td class="width85"><div class="css3div height_28"></div></td>
                        }
                          @{mark_count = 0; }

                        </tr> 
                        <tr class="datagrid-header-row ">
                        <td class="width85"><div class="css3div height_28">定额编号：</div></td>
                        
                        @foreach (var n in no)
                        {
                            mark_count++;
                            string temp_str;
                            dy_number.TryGetValue(n, out temp_str);
                            <td class="width85">@temp_str</td>
                            if (mark_count >= max_col)
                            {
                                break;
                            }
                        } 
                          @for (int i = mark_count; i < max_col; i++)
                          {
                            <td class="width85"></td>
                          }
                              @{mark_count = 0; }
                         </tr>
                                flag = Model.TryGetValue("count", out obj);
                                int k = (int)obj;
                                for (int i = 1; i <= k; i++)
                                {
                             <tr class="datagrid-header-row ">
                              <td class="width85"><div class="css3div height_28">日期：</div></td>
                            @foreach (var n in no)
                            {
                                mark_count++;
                                string temp_str;
                                dy_process.TryGetValue(n, out temp_str);
                                flag = Model.TryGetValue(temp_str, out obj);//取出工序对应的人
                                IDictionary<string, Object> dy_data = (IDictionary<string, Object>)obj;
                                Object vm;
                                flag = dy_data.TryGetValue(i.ToString(), out vm);
                                DateTime td = DateTime.Now;
                                if (flag)
                                {
                                    VM_AssemBigBillPartForDetailShow bill = (VM_AssemBigBillPartForDetailShow)vm;//顺序号
                                    <td class="width85"><input type="hidden" name="no" value="@i"/><input type="text" class="old" name="date" value="@bill.OperateDate"/></td>
                                }
                                else
                                {
                                    <td class="width85"><input type="hidden" name="no" value="@i"/><input type="text" name="date" value="@td.ToString("yyyy/MM/dd")" /></td>
                                }
                                if (mark_count >= max_col)
                                {
                                    break;
                                }
                            }
                                  @for (int n = mark_count; n < max_col; n++)
                                  {
                                <td class="width85"></td>
                                  }
                                    @{mark_count = 0; }

                             </tr>
                            <tr class="datagrid-header-row ">
                              <td class="width85"><div class="css3div height_28">操作者：</div></td>
                            @foreach (var n in no)
                            {
                                mark_count++;
                                string temp_str;
                                dy_process.TryGetValue(n, out temp_str);
                                flag = Model.TryGetValue(temp_str, out obj);//取出工序对应的人
                                IDictionary<string, Object> dy_data = (IDictionary<string, Object>)obj;
                                Object vm;
                                flag = dy_data.TryGetValue(i.ToString(), out vm);
                                if (flag)
                                {
                                    VM_AssemBigBillPartForDetailShow bill = (VM_AssemBigBillPartForDetailShow)vm;//工序顺序
                                    <td class="width85"><input type="hidden" name="op_pro_no" value="@n" /><input type="text" class="old" name="opetator"  value="@bill.Operator" /><input name="newData" type="hidden" value="0"/></td>
                                }
                                else
                                {
                                    <td class="width85"><input type="hidden" name="op_pro_no" value="@n" /><input type="text" name="opetator" value="" /><input name="newData" type="hidden" value="1"/></td>
                                }
                                if (mark_count >= max_col)
                                {
                                    break;
                                }
                            }
                                 @for (int n = mark_count; n < max_col; n++)
                                 {
                                <td class="width85"></td>
                                 }
                                   @{mark_count = 0; }
                             </tr>
                             <tr class="datagrid-header-row ">
                              <td class="width85"><div class="css3div height_28">数量：</div></td>
                            @foreach (var n in no)
                            {
                                mark_count++;
                                string temp_str;
                                dy_process.TryGetValue(n, out temp_str);
                                flag = Model.TryGetValue(temp_str, out obj);//取出工序对应的人
                                IDictionary<string, Object> dy_data = (IDictionary<string, Object>)obj;
                                Object vm;
                                flag = dy_data.TryGetValue(i.ToString(), out vm);
                                if (flag)
                                {
                                    VM_AssemBigBillPartForDetailShow bill = (VM_AssemBigBillPartForDetailShow)vm;
                                    <td class="width85"><input type="text" name="count" class="old" value="@bill.RealOperateCount.ToString("0")" /></td>
                                }
                                else
                                {
                                    <td class="width85"><input type="text" name="count" value="" /></td>
                                }
                                if (mark_count >= max_col)
                                {
                                    break;
                                }
                            }
                            @for (int n = mark_count; n < max_col; n++)
                            {
                            <td class="width85"></td>
                            }
                            @{ temp_count = mark_count;
                               mark_count = 0;}
                             </tr>
                                }
                                if (temp_count < max_col)
                                {
                         
                                }
                          
                          }
                            </table>
                          
                                //第二个table
                                if (temp_count >= max_col)
                                {
                              <table class="datagrid-htable table_detail"  id="table_detail_2">
                                <tr class="datagrid-header-row ">
                                <td class="width85"><div class="css3div height_28">工序：</div></td>
                                    @for (int c = temp_count - 1; c < no.Count(); c++)
                                    {
                                        new_count++;
                                        string temp_str;
                                        int n = no.ElementAt(c);
                                        dy_process.TryGetValue(n, out temp_str);
                                        <td class="width85"><div class="css3div height_28">@temp_str<input name="process_no"  type="hidden" value="@n"/></div></td>
                               
                                    }
                                    @for (int i = new_count; i < max_col; i++)
                                    {
                                        <td class="width85"><div class="css3div height_28"></div></td>
                                    }
                                    @{new_count = 0;}

                                </tr> 
                                <tr class="datagrid-header-row ">
                                <td class="width85"><div class="css3div height_28">定额编号：</div></td>
                                    @for (int c = temp_count - 1; c < no.Count(); c++)
                                    {
                                        new_count++;
                                        string temp_str;
                                        int n = no.ElementAt(c);
                                        dy_number.TryGetValue(n, out temp_str);
                                        <td class="width85">@temp_str</td>
                                
                                    } 
                                      @for (int i = new_count; i < max_col; i++)
                                      {
                                        <td class="width85"></td>
                                      }
                                     @{new_count = 0;}
                                 </tr>
                                  @for (int i = 1; i <= k; i++)
                                  {
                                         <tr class="datagrid-header-row ">
                                          <td class="width85"><div class="css3div height_28">日期：</div></td>
                                            @for (int c = temp_count - 1; c < no.Count(); c++)
                                            {
                                                new_count++;
                                                string temp_str;
                                                int n = no.ElementAt(c);
                                                dy_process.TryGetValue(n, out temp_str);
                                                flag = Model.TryGetValue(temp_str, out obj);//取出工序对应的人
                                                IDictionary<string, Object> dy_data = (IDictionary<string, Object>)obj;
                                                Object vm;
                                                flag = dy_data.TryGetValue(i.ToString(), out vm);
                                                DateTime td = DateTime.Now;
                                                if (flag)
                                                {
                                                    VM_AssemBigBillPartForDetailShow bill = (VM_AssemBigBillPartForDetailShow)vm;
                                                    <td class="width85"><input type="hidden" name="no" value="@i"/><input type="text" class="old" name="date"  value="@bill.OperateDate"/></td>
                                                }
                                                else
                                                {
                                                    <td class="width85"><input type="hidden" name="no" value="@i"/><input type="text" name="date"  value="@td.ToString("yyyy/MM/dd")" /></td>
                                                }
                                            }
                                              @for (int n = new_count; n < max_col; n++)
                                              {
                                                <td class="width85"></td>
                                              }
                                              @{new_count = 0;}

                                         </tr>
                                         <tr class="datagrid-header-row ">
                                          <td class="width85"><div class="css3div height_28">操作者：</div></td>
                                           @for (int c = temp_count - 1; c < no.Count(); c++)
                                           {
                                               new_count++;
                                               string temp_str;
                                               int n = no.ElementAt(c);
                                               dy_process.TryGetValue(n, out temp_str);
                                               flag = Model.TryGetValue(temp_str, out obj);//取出工序对应的人
                                               IDictionary<string, Object> dy_data = (IDictionary<string, Object>)obj;
                                               Object vm;
                                               flag = dy_data.TryGetValue(i.ToString(), out vm);
                                               if (flag)
                                               {
                                                   VM_AssemBigBillPartForDetailShow bill = (VM_AssemBigBillPartForDetailShow)vm;
                                                    <td class="width85"><input type="hidden" name="op_pro_no" value="@n" /><input type="text" class="old" name="opetator"  value="@bill.Operator" /><input name="newData" type="hidden" value="0"/></td>
                                               }
                                               else
                                               {
                                                    <td class="width85"><input type="hidden" name="op_pro_no" value="@n" /><input type="text" name="opetator"  value="" /><input name="newData" type="hidden" value="1"/></td>
                                               }
                                           }
                                             @for (int n = new_count; n < max_col; n++)
                                             {
                                                <td class="width85"></td>
                                             }
                                              @{new_count = 0;}
                                         </tr>
                                         <tr class="datagrid-header-row ">
                                           <td class="width85"><div class="css3div height_28">数量：</div></td>
                                           @for (int c = temp_count - 1; c < no.Count(); c++)
                                           {
                                               new_count++;
                                               string temp_str;
                                               int n = no.ElementAt(c);
                                               dy_process.TryGetValue(n, out temp_str);
                                               flag = Model.TryGetValue(temp_str, out obj);//取出工序对应的人
                                               IDictionary<string, Object> dy_data = (IDictionary<string, Object>)obj;
                                               Object vm;
                                               flag = dy_data.TryGetValue(i.ToString(), out vm);
                                               if (flag)
                                               {
                                                   VM_AssemBigBillPartForDetailShow bill = (VM_AssemBigBillPartForDetailShow)vm;
                                                    <td class="width85"><input type="text" name="count" class="old"  value="@bill.RealOperateCount.ToString("0")" /></td>
                                               }
                                               else
                                               {
                                                    <td class="width85"><input type="text" name="count"  value="" /></td>
                                               }
                                           }
                                            @for (int n = new_count; n < max_col; n++)
                                            {
                                                <td class="width85"></td>
                                            }
                                              @{new_count = 0;}
                                         </tr>
                                  }
                                    
                                </table>
                            }
                    }

                }
           }
            <table class="datagrid-htable table_detail"  id="">
                  <tr class="datagrid-header-row ">
                             <td class="" colspan="2"><div class="css3div height_28">备注：</div></td>
                             <td  colspan="2"><input name="remark" value="@ViewBag.bill.Remark" type="text" style="width:885px;height:24px;"/></td>
                             </tr>
                            <tr class="datagrid-header-row ">
                             <td  colspan ="3"><div class="css3div height_28">成品检验结果：</div></td>
                             <td ><input name="checkResult" value="@ViewBag.bill.ProductCheckResult" type="text" style="width:800px;height:24px;"/></td>
                             </tr>

            </table>
        <div class="margin_top20">
            <table class="table_Bottom">
                <tr>
                    <td style="text-align:left">
                        <span class="font_size16">调度员：@UserHelpers.AutoSearchUser("DispatcherID", "DispatcherID", "DispatcherID")<input type="hidden" name="DispatcherID" value=""/></span>
                    </td>
                    <td>
                        <span class="font_size16">检验员：@UserHelpers.AutoSearchUser("CheckerID", "CheckerID", "CheckerID")<input type="hidden" name="CheckerID" value=""/></span>
                    </td>
                    <td style="text-align:right"> 
                        <span class="font_size16">组长：@UserHelpers.AutoSearchUser("TeamLeaderID","",ViewBag.bill.TeamLeaderID,ViewBag.bill.TeamLeaderID)</span>
                    </td>
                </tr>
            </table>
        </div>
    </form>
</div>
